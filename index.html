<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBAT - Anasayfa</title>
    <link rel="icon" href="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/pngikologo.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Quicksand:wght@400&display=swap" rel="stylesheet">
    
    <style>
        /* Lightbox & Galeri Stilleri */
        .lightbox-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); display: none;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .lightbox-overlay img {
            max-width: 90%; max-height: 90%; border: 5px solid white; border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .lightbox-controls {
            position: absolute; top: 50%; width: 100%; display: flex;
            justify-content: space-between; transform: translateY(-50%); pointer-events: none;
        }
        .lightbox-controls button {
            background: rgba(255, 255, 255, 0.1); color: white; border: none;
            font-size: 3rem; padding: 20px; cursor: pointer; pointer-events: auto;
            transition: background 0.3s;
        }
        .lightbox-controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Yatay KaydÄ±rma Åžeridi */
        .media-scroller {
            display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; margin: 20px 0;
            scrollbar-width: thin; scrollbar-color: #a90000 #eee;
        }
        .media-scroller::-webkit-scrollbar { height: 8px; }
        .media-scroller::-webkit-scrollbar-thumb { background-color: #a90000; border-radius: 4px; }
        
        .media-item {
            height: 180px; width: auto; border-radius: 8px; flex-shrink: 0; cursor: pointer;
            transition: transform 0.2s; object-fit: cover; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            background: #000;
        }
        .media-item:hover { transform: scale(1.02); }
    </style>
</head>

<body>

    <header>
        <div class="brand-container">
            <img src="https://github.com/Riwelda/BBAT/blob/main/unilogo.jpg?raw=true" alt="Kastamonu Ãœni Logo">
            <div class="site-title" style="margin: 0 15px; text-align:center;">
                <h1>BÄ°YOLOJÄ°K BÄ°LÄ°MLER<br>ARAÅžTIRMA TOPLULUÄžU</h1>
            </div>
            <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/pngikologo.png" alt="BBAT Logo">
        </div>
        <div class="menu-toggle" id="menu-toggle">&#9776;</div>
        <nav class="nav-links" id="nav-links">
            <ul>
                <li><a href="index.html">Anasayfa</a></li>
                <li><a href="hakkimizda.html">HakkÄ±mÄ±zda</a></li>
                <li><a href="projeler.html">Etkinlikler</a></li>
                <li><a href="iletisim.html">Ä°letiÅŸim</a></li>
            </ul>
            <div class="auth-buttons-container">
                <div id="auth-buttons" style="display: flex; gap: 10px;">
                    <button id="login-btn" class="btn btn-outline">GiriÅŸ Yap</button>
                    <button id="signup-btn" class="btn btn-primary">KayÄ±t Ol</button>
                </div>
                <div id="user-info" style="display: none; align-items: center; gap: 10px;">
                    <span id="welcome-text" style="font-weight: bold; color: #a90000; font-size: 0.9rem;"></span>
                    <button id="logout-btn" class="btn btn-primary" style="background-color: #333;">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="hero-wrapper">
            <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/fenfak.jpeg" alt="Kastamonu Ãœniversitesi" class="hero-img">
            <div class="hero-content">
                <h1>DoÄŸayÄ± KeÅŸfet, Bilimle Koru.</h1>
                <p>Kastamonu Ãœniversitesi Biyolojik Bilimler AraÅŸtÄ±rma TopluluÄŸu</p>
            </div>
        </div>
        
        <div class="duyurular-container">
            <div class="whatsapp-card">
                <div class="wa-icon">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
                </div>
                <div class="wa-content">
                    <h3>BBAT WhatsApp KanalÄ± AÃ§Ä±ldÄ±!</h3>
                    <p>Duyurular, anketler ve etkinliklerden anÄ±nda haberdar olmak iÃ§in kanalÄ±mÄ±za katÄ±lÄ±n.</p>
                </div>
                <div class="wa-action">
                    <a href="https://whatsapp.com/channel/0029VbAhiY9AInPi7ie7e02H" target="_blank" class="btn-whatsapp">
                        KanalÄ± GÃ¶rÃ¼ntÃ¼le
                    </a>
                </div>
            </div>

            <article class="duyurular">
                <h2>GÃœNCEL DUYURULAR!</h2>
                <div id="duyuru-listesi">
                    <p style="text-align: center; color: gray; padding: 20px;">Duyurular yÃ¼kleniyor...</p>
                </div>
            </article>
        </div>
        
        <article class="etkinlik-onizleme">
            <h2>Etkinliklerimizin BirkaÃ§Ä±...</h2>
            <p class="meta">Yazar: Alper YAMAN | Tarih: 17 Åžubat 2025</p>
            <p>Ilgaz DaÄŸÄ± Milli ParkÄ±nda mantar yÃ¼rÃ¼yÃ¼ÅŸÃ¼ etkinliÄŸi, "SÃ¶zde Bilim" KonferansÄ±, "Omik Ã‡aÄŸÄ±nda Biyoinformatik" Konulu Sunum, TanÄ±ÅŸma kahvaltÄ±mÄ±z, Ã‡anakkale'deki Biyogaz Tesisi, Bioinnovation 2024 yarÄ±ÅŸmasÄ±, "BuzullarÄ±n Erimesi" Konulu Panel ve daha fazlasÄ± "Etkinliklerimiz" sekmesinde sizi bekliyor!</p>

            <div class="media-scroller gallery-group" id="anasayfa-galeri">
                <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/etk1.jpg" alt="Etkinlik 1" class="media-item" onclick="showImage(this)">
                <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/etk2.jpg" alt="Etkinlik 2" class="media-item" onclick="showImage(this)">
                <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/etk3.jpg" alt="Etkinlik 3" class="media-item" onclick="showImage(this)">
                <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/etk4.jpg" alt="Etkinlik 4" class="media-item" onclick="showImage(this)">
                <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/etk5.jpg" alt="Etkinlik 5" class="media-item" onclick="showImage(this)">
                <img src="https://raw.githubusercontent.com/Riwelda/BBAT/refs/heads/main/afis26mart2.jpg" alt="Etkinlik 6" class="media-item" onclick="showImage(this)">
                
                </div>
        </article>

    </main>

    <footer>
        <p>&copy; 2025 BBAT, Kastamonu Ãœniversitesine BaÄŸlÄ± Bir Ã–ÄŸrenci TopluluÄŸudur.</p>
    </footer>

    <div class="lightbox-overlay" id="lightbox">
        <div class="lightbox-controls">
            <button id="prev-btn">&#10094;</button>
            <button id="next-btn">&#10095;</button>
        </div>
        <img id="lightbox-img" src="" alt="BÃ¼yÃ¼tÃ¼lmÃ¼ÅŸ GÃ¶rsel">
    </div>

    <script>
        // MenÃ¼
        const menuToggle = document.getElementById('menu-toggle');
        const navLinks = document.getElementById('nav-links');
        if(menuToggle) {
            menuToggle.addEventListener('click', () => { navLinks.classList.toggle('active'); });
        }

        // YÃ¶nlendirmeler
        document.getElementById("signup-btn").addEventListener("click", () => window.location.href = "register.html");
        document.getElementById("login-btn").addEventListener("click", () => window.location.href = "login.html");

        // --- GALERÄ° MANTIÄžI ---
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        let currentGalleryImages = [];
        let currentIndex = 0;

        // Statik resimler iÃ§in
        document.querySelectorAll('img.media-item').forEach(img => {
            img.addEventListener('click', () => showImage(img));
        });

        // Dinamik resimler iÃ§in (Function)
        window.openDynamicLightbox = function(src) {
            if(lightbox && lightboxImg) {
                lightboxImg.src = src;
                lightbox.style.display = 'flex';
                if(prevBtn) prevBtn.style.display = 'none';
                if(nextBtn) nextBtn.style.display = 'none';
            }
        }

        function showImage(imgElement) {
            const group = imgElement.closest('.gallery-group');
            if (!group) {
                currentGalleryImages = [imgElement];
            } else {
                currentGalleryImages = Array.from(group.querySelectorAll('img.media-item'));
            }

            const index = currentGalleryImages.indexOf(imgElement);
            if(index === -1) return;
            
            currentIndex = index;
            updateLightboxImage();
            
            if (currentGalleryImages.length > 1) {
                if(prevBtn) prevBtn.style.display = 'block';
                if(nextBtn) nextBtn.style.display = 'block';
            } else {
                if(prevBtn) prevBtn.style.display = 'none';
                if(nextBtn) nextBtn.style.display = 'none';
            }

            lightbox.style.display = 'flex';
        }

        function updateLightboxImage() {
            lightboxImg.src = currentGalleryImages[currentIndex].src;
        }

        function navigateLightbox(direction) {
            if (currentGalleryImages.length <= 1) return;
            currentIndex += direction;
            if (currentIndex < 0) currentIndex = currentGalleryImages.length - 1;
            if (currentIndex >= currentGalleryImages.length) currentIndex = 0;
            updateLightboxImage();
        }

        if(prevBtn) prevBtn.addEventListener('click', (e) => { e.stopPropagation(); navigateLightbox(-1); });
        if(nextBtn) nextBtn.addEventListener('click', (e) => { e.stopPropagation(); navigateLightbox(1); });
        if(lightbox) lightbox.addEventListener('click', () => { lightbox.style.display = 'none'; currentGalleryImages = []; });
    </script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAdPt8XuUEzJugYI2R9NpUXUCUQXttHaXI",
            authDomain: "bbat-295c4.firebaseapp.com",
            projectId: "bbat-295c4",
            appId: "1:849546748999:web:476431352773d260fcfd62"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const auth = firebase.auth();
        const db = firebase.firestore();

        const authButtons = document.getElementById('auth-buttons');
        const userInfo = document.getElementById('user-info');
        const welcomeText = document.getElementById('welcome-text');
        const navUl = document.querySelector('.nav-links ul');

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'flex';

                const adminEmail = "alperymnay@gmail.com"; 
                if(user.email === adminEmail) {
                    if(!document.getElementById('admin-link')) {
                        const li = document.createElement('li');
                        li.innerHTML = '<a href="admin.html" id="admin-link" style="color:red; font-weight:bold;">YÃ–NETÄ°M</a>';
                        navUl.appendChild(li);
                    }
                }

                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    let username = user.email.split('@')[0];
                    if (userDoc.exists && userDoc.data().username) username = userDoc.data().username;
                    welcomeText.textContent = `Merhaba, ${username}`;
                } catch (error) {
                    welcomeText.textContent = `Merhaba, ${user.email.split('@')[0]}`;
                }
            } else {
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
                if(document.getElementById('admin-link')) document.getElementById('admin-link').parentElement.remove();
            }
        });

        // --- DUYURULARI Ã‡EKME (VÄ°DEO DESTEKLÄ°) ---
        db.collection("duyurular").onSnapshot(
            (snapshot) => {
                const liste = document.getElementById("duyuru-listesi");
                if(!liste) return;
                
                liste.innerHTML = ""; 

                if(snapshot.empty) { 
                    liste.innerHTML = "<p style='text-align:center; padding:20px; color:#666;'>HenÃ¼z gÃ¼ncel bir duyuru yok.</p>"; 
                    return; 
                }

                // Verileri diziye alÄ±p sÄ±ralayalÄ±m
                let duyurular = [];
                snapshot.forEach(doc => {
                    duyurular.push(doc.data());
                });

                // Yeniden eskiye sÄ±rala
                duyurular.sort((a, b) => {
                    let dateA = a.olusturulmaTarihi ? a.olusturulmaTarihi.seconds : 0;
                    let dateB = b.olusturulmaTarihi ? b.olusturulmaTarihi.seconds : 0;
                    return dateB - dateA;
                });

                // Helper: Video mu?
                function isVideo(url) {
                    // Linkin iÃ§inde .mp4, .webm vs geÃ§iyor mu diye bakar (raw=true olsa bile tanÄ±r)
                    return url.match(/\.(mp4|webm|ogg)/i);
                }

                duyurular.forEach(veri => {
                    let medyaHTML = '';
                    
                    if(veri.resim && veri.resim.length > 5) {
                        if (isVideo(veri.resim)) {
                            // EÄžER VÄ°DEO Ä°SE: Video oynatÄ±cÄ± koy
                            medyaHTML = `
                                <video controls style="width:100%; max-width:100%; border-radius:8px; margin-bottom:15px; background:black; display:block;">
                                    <source src="${veri.resim}" type="video/mp4">
                                    TarayÄ±cÄ±nÄ±z bu videoyu desteklemiyor.
                                </video>`;
                        } else {
                            // EÄžER RESÄ°M Ä°SE: Resim koy (Eski hali)
                            medyaHTML = `<img src="${veri.resim}" class="duyuru-img" onclick="openDynamicLightbox(this.src)" style="cursor:pointer; margin-bottom:15px; display:block;">`;
                        }
                    }

                    const duyuruHTML = `
                        <div class="duyuru-item">
                            <span class="meta" style="color:#a90000; font-weight:bold; display:block; margin-bottom:10px;">ðŸ“… ${veri.tarih}</span>
                            ${medyaHTML}
                            <div class="duyuru-text">
                                <p style="white-space: pre-wrap;">${veri.icerik}</p>
                            </div>
                        </div>`;
                    liste.innerHTML += duyuruHTML;
                });
            },
            (error) => {
                console.error("Duyuru Ã§ekme hatasÄ±:", error);
                const liste = document.getElementById("duyuru-listesi");
                if(liste) liste.innerHTML = "<p style='text-align:center; color:red; padding:20px;'>Duyurular yÃ¼klenirken bir hata oluÅŸtu.</p>";
            }
        );
        // --- SON ETKÄ°NLÄ°KLERÄ° ANASAYFA GALERÄ°SÄ°NE EKLEME (VÄ°DEO DESTEKLÄ°) ---
        db.collection('etkinlikler').orderBy('olusturulmaTarihi', 'desc').limit(5).onSnapshot(snapshot => {
            const galeri = document.getElementById('anasayfa-galeri');
            
            // Helper: Video mu?
            function isVideo(url) { return url.match(/\.(mp4|webm|ogg)$/i); }

            snapshot.forEach(doc => {
                const data = doc.data();
                if(data.kapakResmi) {
                    
                    if (isVideo(data.kapakResmi)) {
                        // Video ise
                        const video = document.createElement('video');
                        video.src = data.kapakResmi;
                        video.className = "media-item";
                        video.controls = true;
                        galeri.appendChild(video);
                    } else {
                        // Resim ise
                        const img = document.createElement('img');
                        img.src = data.kapakResmi;
                        img.alt = data.baslik;
                        img.className = "media-item";
                        img.onclick = function() { showImage(this); };
                        galeri.appendChild(img);
                    }
                }
            });
        });

        document.getElementById("logout-btn").addEventListener("click", () => {
            auth.signOut().then(() => window.location.reload());
        });
    </script>
</body>
</html>
